<html>
<meta http-equiv="Cache-Control" content="no-store" />
<head>
<title>Elasticsearch Tableau Web Data Connector</title>

<!--(if target dev)><!--> 
  <link rel="stylesheet" href="bootstrap.css">
  <link rel="stylesheet" href="bootstrap-datepicker.css">
  <link rel="stylesheet" href="elasticsearch-connector.css">
<!--<!(endif)-->
<!--(if target dist)><!-->   
  <link rel="stylesheet" href="elasticsearch-connector.min.css">
<!--<!(endif)-->

</head>
<body>



  <div class="container-fluid">
    
    <div class="row title-row">
      <div class="col-md-10 col-md-offset-1">

        
        <div class="es-logo pull-left"></div>
        <div class="title pull-left"><h2>Tableau Web Data Connector</h2></div>
        
      </div>
    </div>
    
    <div id="divMessage" class="row" style="display: none">
      <div class="col-md-10 col-md-offset-1">
        <div class="alert alert-success">
        <p id="messageText"></p>
        </div>
      </div>
    </div>
    <div id="divError" class="row" style="display: none">
      <div class="col-md-10 col-md-offset-1">
        <div class="alert alert-danger">
        <p id="errorText"></p>
        </div>
      </div>
    </div>
    
    <div class="row no-tableau">
      <div class="col-md-10 col-md-offset-1">
        <div class="alert alert-info">
        <p>Please open this URL from within Tableau</p>
        </div>
      </div>
    </div>
        
    <div class="row tableau">
      <div class="col-md-10 col-md-offset-1">
   

          <div class="form-group">
            <label for="inputConnectionName">Connection Name</label>
            <input class="form-control" id="inputConnectionName" placeholder="Enter unique name of Tableau Data Connection">
          </div>
          <div class="checkbox">
            <label>
              <input id="cbUseBasicAuth" type="checkbox">Use HTTP Basic Authentication?
            </label>
          </div>
          <div class="checkbox basic-auth-control" style="display: none;">
            <label>
              <input id="cbUseSyncClientWorkaround" type="checkbox">Use Online Sync Client workaround?
              <i id="iconUseSyncClientWorkaround" class="glyphicon glyphicon-info-sign"
                 title="Use Sync Client Workaround" 
                 data-content="When checked, the datasource will store the username and password credentials used to authenticate to Elasticsearch as normal connection properties.  This works around an issue in refreshing web data connector sources that use authentication in the Online Sync Client.  Storing credentials as connection properties means that they are written in cleartext in log files and other places the datasource is persisted.  If you don't intend to use the Online Sync Client then keep this option unchecked."></i>
            </label>
          </div>
          <div class="form-group basic-auth-control" style="display: none;">
            <label for="inputUsername">Username</label>
            <input class="form-control" id="inputUsername" placeholder="Elasticsearch username" autocomplete="off">
          </div>
          <div class="form-group basic-auth-control" style="display: none;">
            <label for="inputPassword">Password</label>
            <input type="password" class="form-control" id="inputPassword" autocomplete="off">
          </div>
          <div class="form-group">
            <label for="inputElasticsearchUrl">Elasticsearch URL</label>
            <input class="form-control" id="inputElasticsearchUrl" placeholder="Elasticsearch URL">
          </div>
          <div class="form-group">
            <label for="inputElasticsearchIndexTypeahead">Index Name</label>
            <input class="form-control" id="inputElasticsearchIndexTypeahead" type="text" data-provide="typeahead" 
                   autocomplete="off" placeholder="Name of index like 'index1'">
                <i class="index-icon glyphicon glyphicon-refresh icon-refresh-animate hide"></i>
            </input>

          </div>
          <div class="form-group">
            <label for="inputElasticsearchTypeTypeahead">Type</label>
            <input class="form-control" id="inputElasticsearchTypeTypeahead" type="text" data-provide="typeahead"
                   autocomplete="off" placeholder="Name of type like 'user'">
                <i class="type-icon glyphicon glyphicon-refresh icon-refresh-animate hide"></i>
            </input>

          </div>
          <div>
          </div>

          <div class="form-group">

            <div id="divResultMode" class="btn-group" data-toggle="buttons">
  <label class="btn btn-default active">
    <input type="radio" name="resultmode" autocomplete="off" value="search" checked>Search Result Mode</input>
  </label>
  <label class="btn btn-default">
    <input type="radio" name="resultmode" autocomplete="off" value="aggregation">Aggregation Mode</input>
  </label>
</div>

          </div>

          <div id="divSearchResultControls" style="display: none;">

          <div class="checkbox">
            <label>
              <input id="cbUseQuery" type="checkbox">Use custom query?
            </label>
          </div>
          <div id="divQuery" class="form-group" style="display: none;">
            <label for="textElasticsearchQuery">Query</label>
            
            <div id="divElasticsearchQueryEditor" class="query-editor">
            </div>

          </div>
          <div class="form-group">
            <label for="inputBatchSize">Batch record size for each response</label>
            <input type="number" class="form-control" id="inputBatchSize" value="10" placeholder="Batch size per request">
          </div>
          <div class="form-group">
            <label for="inputTotalLimit">Limit on number of rows to extract</label>
            <input type="number" class="form-control" id="inputTotalLimit" value="100" placeholder="Total limit">
          </div>

          </div>

          <div id="divAggregationResultControls" style="display: none;">

            <div class="checkbox">
              <label>
                <input id="cbUseAggregationQuery" type="checkbox"
                       data-bind="checked: useCustomQuery" checked>Use custom query?
              </label>
            </div>

              <div id="divAggregationBuilder" class="form-group" data-bind="visible: !useCustomQuery()">

                  <div class="checkbox">
                      <label>
                          <input id="cbUseAggregationFilter" type="checkbox"
                                 data-bind="checked: useAggFilter" checked>Filter data included in aggregations?
                      </label>
                  </div>

                <div class="form-group" data-bind="visible: useAggFilter">

                    <div class="input-group input-group-unstyled">
                        <label>Filter</label>
                        <input type="text" class="form-control" placeholder="Enter filter using Query String syntax, e.g. 'field_name:match AND date:[2015-01-01 TO 2016-01-01] or _exists_:field_name'" data-bind="value: aggregationFilter">

                        <span class="input-group-addon">
                        <i id="iconInfoAggregationFilter" class="glyphicon glyphicon-info-sign input-group-inline-icon"
                                            title="Aggregation Filter"></i>
                    </span>
                    </div>

                </div>

                  <div class="aggregation-builder-container metrics-builder">
                      <h4 class="agg-section">Metrics per Aggregation Bucket</h4>

                      <div data-bind="foreach: { data: metrics }">

                          <form class="form-inline card">

                              <div class="form-group">
                                  <label>Metric</label>
                                  <select class="form-control" data-bind="options: $parent.metricTypes, value: type"></select>
                              </div>

                              <div class="form-group" data-bind="visible: type() != 'Count'">
                                  <label>Field</label>
                                  <select class="form-control" data-bind="options: $parent.metricFields, value: field, optionsText: 'name',"></select>
                              </div>

                              <div class="clearfix">
                              </div>

                              <div class="form-group pull-right">
                                  <button type="button" class="btn btn-default" aria-label="Remove" data-bind="click: $parent.removeMetric">
                                      Remove
                                  </button>
                              </div>

                              <div class="clearfix">
                              </div>                              

                          </form>
                       

                      </div>

                      <button class="btn btn-default" data-bind="click: addMetric">Add Metric
                        <span class="glyphicon glyphicon-stats" aria-hidden="true"></span>
                      </button>
                  </div>

                  <div class="aggregation-builder-container buckets-builder">
                      <h4 class="agg-section">Aggregation Buckets</h4>

                      <div data-bind="foreach: { data: buckets }">

                          <div class="card" data-bind="css: 'bucket_level_' + $index()">

                          <div class="form-group">
                              <div class="form-group">
                                  <label>Bucket</label>
                                  <select class="form-control" data-bind="options: $parent.bucketTypes, value: type"></select>
                              </div>

                              <div class="form-group">
                                  <label>Field</label>
                                  <select class="form-control" data-bind="options: fields, value: field"></select>
                              </div>
                          </div>

                          <div class="form-inline" data-bind="visible: type() == 'Terms'">

                              <div class="form-group">
                                  <label>Number of Terms</label>                                           
                                  <input type="number" class="form-control bucket-number-input" data-bind="value: termSize">
                                  <i data-bind="bootstrapPopover" class="glyphicon glyphicon-info-sign"
                                     data-toggle="popover"
                                     data-trigger="hover"
                                     title="Number of Terms" 
                                     data-content="Defines the maximum number of unique terms to aggregate metrics to for the selected field.  Default of '0' will retrieve all"></i>
                              </div>

                          </div>

                          <div class="form-inline" data-bind="visible: type() == 'Date Histogram'">

                              <div class="form-group">
                                  <label>Interval</label>
                                  <select class="form-control" data-bind="options: $parent.dateHistogramIntervalOptions, value: dateHistogramType"></select>
                              </div>

                              <div class="form-group" data-bind="visible: dateHistogramType() == 'Custom'">
                                  <label for="inputDateHistogramIntervalCustom">Custom Interval Value</label>
                                  <input type="text" class="form-control" id="inputDateHistogramIntervalCustom" 
                                         placeholder="Enter interval value e.g. 3M, 2y, 5m"
                                         data-bind="value: dateHistogramCustomInterval">
                                  <i data-bind="bootstrapPopover" class="glyphicon glyphicon-info-sign"
                                     data-toggle="popover"
                                     data-trigger="hover"
                                     title="Custom Interval Value" 
                                     data-content="Value that defines a custom interval.  Examples: 1w - every 1 week, 4M - every 4 months, 22y - every 22 years, 30m - every 30 minutes"></i>
                              
                              </div>

                          </div>

                          <div class="form-group" data-bind="visible: type() == 'Range'">
                              <label>Ranges</label> 

                              <div data-bind="foreach: { data: ranges }">

                                  <form class="form-inline">

                                      <div class="form-group">
                                          <label>From</label>
                                          <input type="text" class="form-control" data-bind="value: from">
                                      </div>
                                      <div class="form-group">
                                          <label>To</label>
                                          <input type="text" class="form-control" data-bind="value: to">
                                      </div>
                                      <div class="form-group">
                                          <button type="button" class="btn btn-default" aria-label="Remove" data-bind="click: $parent.removeRange">
                                              <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>
                                          </button>
                                      </div>

                                   </form>

                              </div>

                              <button class="btn btn-default" data-bind="click: addRange">Add Range</button>
                          </div>

                          <div class="form-group" data-bind="visible: type() == 'Date Range'">
                              <label>Date Ranges</label>

                              <div data-bind="foreach: { data: dateRanges }">

                                  <form class="form-inline range-row" data-bind="css: { alternaterow: $index() % 2 }">
                                      <div class="form-group">
                                          
                                          <label>From</label>
                                          <div class="form-group">
                                              <select class="form-control" data-bind="options: $parent.dateRangeTypes, value: fromType"></select>
                                          </div>

                                          <div class="input-group date" data-bind="bootstrapDatePicker, visible: fromType() == 'Absolute'">
                                              <input type="text" class="form-control" data-bind="value: from">
                                              <span class="input-group-addon"><i class="glyphicon glyphicon-calendar"></i></span>
                                          </div>

                                          <input type="number" class="form-control date-range-number" data-bind="value: relativeNumFrom, visible: fromType() == 'Relative'">
                                          <select class="form-control" data-bind="options: $parent.relativeOptions, value: fromRelative, visible: fromType() == 'Relative'"></select>

                                          <input type="text" class="form-control" data-bind="value: from, visible: fromType() == 'Custom'"
                                                 placeholder="Enter custom date e.g. 'now-3M/M'">
                                          
                                      </div>
                                      <div class="form-group">
                                          
                                          <label>To</label>      
                                          <div class="form-group">
                                              <select class="form-control" data-bind="options: $parent.dateRangeTypes, value: toType"></select>
                                          </div>

                                          <div class="input-group date" data-bind="bootstrapDatePicker, visible: toType() == 'Absolute'">
                                              <input type="text" class="form-control" data-bind="value: to">
                                              <span class="input-group-addon"><i class="glyphicon glyphicon-calendar"></i></span>
                                          </div>

                                          <input type="number" class="form-control date-range-number" data-bind="value: relativeNumTo, visible: toType() == 'Relative'">
                                          <select class="form-control" data-bind="options: $parent.relativeOptions, value: toRelative, visible: toType() == 'Relative'"></select>

                                          <input type="text" class="form-control" data-bind="value: to, visible: toType() == 'Custom'">

                                      </div>
                                      <div class="form-group">
                                          <button type="button" class="btn btn-default" aria-label="Remove" data-bind="click: $parent.removeDateRange">
                                              <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>
                                          </button>
                                      </div>
                                   </form>

                              </div>

                              <button class="btn btn-default" data-bind="click: addDateRange">Add Range</button>
                          </div>

                              <div class="clearfix">
                              </div>

                              <div class="form-group pull-right" style="margin-bottom: 0px">
                                  <button type="button" class="btn btn-default" aria-label="Remove" data-bind="click: $parent.removeBucket">
                                      Remove
                                  </button>
                              </div>
                          
                              <div class="clearfix">
                              </div>

                          </div>

                      </div>

                      <button class="btn btn-default" data-bind="click: addBucket">Add Bucket
                        <span class="glyphicon glyphicon-th-large" aria-hidden="true"></span>
                      </button>
                  </div>
              </div>

            <div id="divAggregationQuery" class="form-group" data-bind="visible: useCustomQuery">
              <label>Query</label>
              
              <div id="divElasticsearchAggQueryEditor" class="query-editor">


              </div>

            </div>


          </div>

          <button id="submitButton" type="submit" class="btn btn-primary">Submit</button>

      </div>

    </div>
    <div class="row" style="display: none">
      <div class="col-md-10 col-md-offset-1">
        <div class="alert alert-success">
        <p>To add more rows of data you will need to:</p>
        <ul>
          <li>Select Tableau's data menu
            <li>Select your data source name
              <li>Then select incremental refresh from extract menu.
        </ul>
        </div>
      </div>
    </div>
  </div>

<!-- Modal Start here-->
<div class="modal fade bs-example-modal-sm" id="myPleaseWait" tabindex="-1"
    role="dialog" aria-hidden="true" data-backdrop="static">
    <div class="modal-dialog modal-sm">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">
                    Querying data...
                 </h4>
            </div>
            <div class="modal-body">
                <div class="progress">
                    <div class="progress-bar progress-bar-info
                    progress-bar-striped active"
                    style="width: 100%">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- Modal ends Here -->

  <script src="https://connectors.tableau.com/libs/tableauwdc-1.1.1.js" type="text/javascript"></script>

  <!--(if target dev)><!-->
  <script src="jquery.js" type="text/javascript"></script>
  <script src="bootstrap.js" type="text/javascript"></script>
  <script src="bootstrap3-typeahead.js" type="text/javascript"></script>
  <script src="bootstrap-datepicker.js" type="text/javascript"></script>
  <script src="knockout.js" type="text/javascript"></script>
  <script src="lodash.js" type="text/javascript"></script>
  <script src="moment.js" type="text/javascript"></script>
  <script src="elasticsearch-connector.js" type="text/javascript"></script>
  <script src="aggregations.js" type="text/javascript"></script>
  <script src="ace.js" type="text/javascript"></script>
  <!--<!(endif)-->
  <!--(if target dist)><!-->
  <script src="elasticsearch-connector.min.js" type="text/javascript"></script>
  <!--<!(endif)-->

</body>

</html>